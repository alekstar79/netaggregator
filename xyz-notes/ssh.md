[источник](https://www.hostinger.ru/rukovodstva/ssh-bez-parolia)

## Вход в SSH без пароля

Во-первых, нам нужно проверить, существует ли SSH-ключ для клиентского компьютера.
Это предотвратит перезапись текущей конфигурации. Чтобы узнать, используйте следующую команду:
````
ls -al ~/.ssh/id_*.pub
````

Если ключ уже существует, вы можете
а). пропустить следующий шаг — генерацию SSH-ключа;
б). отменить текущую настройку;
в). создать резервную копию существующего ключа.

Если ключ не существует, вы увидите следующий вывод:
````
ls: cannot access /users/appsadm/.ssh/id_*.pub: No such file or directory
````

#### Далее мы можем приступить непосредственно к генерации SSH-ключа.

##### SSH-доступ по Ключу в Ubuntu и CentOS:
Чтобы сгенерировать открытый и закрытый SSH-ключ в Ubuntu или CentOS, используйте команду:
````
ssh-keygen -t rsa
````

Параметр -t означает тип, а RSA — протокол, используемый для генерации ключей.
RSA является типом по умолчанию, поэтому вы также можете использовать упрощённую версию
команды — ssh-keygen. Длина ключа по умолчанию — 2048 бит. Однако, если вы хотите усилить
защиту, измените значение на 4096 бит. В этом случае команда будет выглядеть так:
````
ssh-keygen -t rsa -b 4096
````

Это интерактивный процесс генерации ключей, и вас попросят выполнить несколько действий:

> Enter file in which to save the key (/home/.ssh.id_rsa), или «Ввести файл для сохранения ключа (/home/.ssh.id_rsa)»  
> Enter passphrase (empty for no passphrase), или «Ввести кодовую фразу (оставьте пустым для отключения кодовой фразы)»

Если вы хотите, чтобы были заданы значения по умолчанию, просто нажмите Enter в ответ
на каждый из этих запросов. Кодовая фраза используется для шифрования закрытого ключа;
однако она не является обязательной и может быть пропущена.
Закрытый ключ будет сохранён в папке по умолчанию — .ssh/id_rsa.
Открытый ключ будет сохранён в файле .ssh/id_rsa.pub. На этом генерация ключа
будет завершена. Вы можете проверить файлы с помощью любого редактора.

Копирование Открытого Ключа для Включения Беспарольного SSH  
Скопировать открытый ключ на машину предназначения можно тремя способами:

С помощью команды ssh-copy-id  
С помощью SSH  
Вручную

Первый вариант является наиболее оптимальным и быстрым. Команда ssh-copy-id по умолчанию
включена в большинство дистрибутивов Linux. Однако, если вы столкнулись с проблемами
при использовании ssh-copy-id или не имеете доступа к этой команде, вы можете попробовать
следующие опции.

**Метод 1:** С Помощью Команды ssh-copy-id
Основной синтаксис этой команды:
````
ssh-copy-id имя_удаленного_пользователя@удаленный_IP_aдрес
````

На этом этапе вам нужно будет ввести пароль удалённого компьютера.
Если аутентификация пройдёт успешно, сгенерированный открытый ключ SSH
будет добавлен в файл author_keys удалённого компьютера.
После добавления записи соединение закроется автоматически.

**Метод 2:** Копирование Закрытого Ключа с Помощью SSH
При этом методе, мы копируем закрытый ключ, используя SSH. Этот вариант сработает
только в том случае, если у вас есть SSH-доступ к серверу на основе пароля.
Команда ниже сделает всю работу. Вам нужно только ввести имя и IP-адрес удалённого
пользователя.

````
cat ~/.ssh/id_rsa.pub | ssh имя_удаленного_пользователя@удаленный_ip_aдрес "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
````

Запись будет добавлена в файл author_keys удалённой машины.

**Метод 3:** Копирование Открытого Ключа Вручную
Третий метод немного сложнее, так как вам придётся всё делать вручную. Однако,
вариант вполне рабочий и вы можете использовать его в отдельных случаях,
когда другие методы не работаю. Вам нужно будет вручную добавить содержимое
файла id_rsa.pub в файл ~/.ssh/authorized_keys удалённого сервера.

Вы можете посмотреть содержимое файла id_rsa.pub с помощью редактора vi или команды cat:
````
cat ~/.ssh/id_rsa.pub
````

Команда выведет ключ, он начинается с ssh-rsa. Скопируйте эго! Затем на удалённом сервере
войдите в систему и создайте файл .ssh, если он не существует.
````
mkdir -p ~/.ssh
````

Также само вы можете создать файл author_keys. Добавьте скопированный открытый SSH-ключ
в пустой файл, как показано ниже:
````
echo SSH_public_key >> ~/.ssh/authorized_keys
````

SSH_public_key — это открытый ключ, который вы скопировали с исходного компьютера.
Он должен начинаться с ssh-rsa.

После того как ключ будет скопирован, вы сможете настроить необходимые разрешения
для каталога .ssh удалённых серверов с помощью команды chmod.
````
chmod -766 ~/.ssh
````

##### Проверка Входа в SSH Без Пароля

К этому моменту SSH-доступ по ключу должен быть успешно активирован и настроен.
Чтобы протестировать эту функцию, можно попробовать подключится к удалённому серверу
через исходный сервер. Синтаксис команды будет выглядеть так:
````
ssh имя_удаленного_пользователя@удаленный_IP_aдрес
````

Если всё прошло успешно, вы войдёте в систему автоматически без ввода пароля.

##### Как Отключить SSH-доступ по Ключу

Если вы решите, что беспарольный SSH вам не подходит, вы можете отключить эту функцию,
выполнив следующие действия. Для этого откройте файл конфигурации SSH — /etc/ssh/ssh_config.
Подойдёт любой текстовый редактор, мы используем nano. Здесь вы найдёте запись с
PasswordAuthentication. Измените строки, как показано ниже:

````
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM no
````

[Соединение через SSH постоянно сбрасывается (обрывается)](https://pc.ru/articles/soedinenie-cherez-ssh-postoyanno-sbrasyvaetsya-obryvaetsya)

Локальный способ для Linux (ssh)

Открываем файл /etc/ssh/ssh_config и в самый низ этого файла добавляем следующие строчки:

````
ServerAliveInterval 60
ServerAliveCountMax 10
````

> ServerAliveInterval 60 - Данный параметр определяет как часто ваш ПК, с которого установлена SSH сессия (клиент), будет отправлять на сервер SSH, к которому вы подключились, пакет, говорящий "я живой". В нашем примере это будет происходить каждые 60 секунд.  
> ServerAliveCountMax 5 - Данный параметр определяет, сколько раз такой пакет "я живой" будет отправлен на сервер в том случае, когда от сервера не последовало ответа, прежде чем принудительно разорвать соединение. В нашем примере 5 раз.

Удаленный способ Linux

Открываем файл /etc/ssh/sshd_config и в самый низ конфигурации дописываем следующие настройки:

````
ClientAliveInterval 60
ClientAliveCountMax 5
````

> ClientAliveInterval 60 - Данный параметр определяет как часто сервер, к которому вы подключены, будет отправлять на ваш компьтер (клиент) пакет, говорящий "я живой". В нашем примере это будет происходить каждые 60 секунд.  
> ClientAliveCountMax 5 - Данный параметр определяет, сколько раз такой пакет "я живой" будет отправлен от сервера на ваш клиентский ПК, когда от вашего ПК не последовало ответа, прежде чем принудительно разорвать соединение. В нашем примере 5 раз.

Чтобы изменения вступили в силу, сохраните файл и перезапустите SSH.
Вот как это сделать в Ubuntu 18.04:
````
sudo systemctl restart ssh
````
